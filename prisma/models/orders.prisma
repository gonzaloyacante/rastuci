// =============================================================================
// ORDER MODELS
// =============================================================================

model order_items {
  id        String   @id @default(cuid())
  quantity  Int
  price     Decimal  @db.Decimal(10, 2)
  orderId   String
  productId String
  color     String?
  size      String?
  orders    orders   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  products  products @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

model orders {
  id                    String               @id @default(cuid())
  customerName          String
  customerPhone         String
  customerAddress       String?
  total                 Decimal              @db.Decimal(10, 2)
  status                OrderStatus          @default(PENDING)
  paymentMethod         String?
  transferProofUrl      String?
  transferSenderName    String?
  transferTransactionId String?
  transferProofAt       DateTime?
  expiresAt             DateTime?
  paymentReminderSent   Boolean?             @default(false)
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  customerEmail         String?
  mpPaymentId           String?
  mpPreferenceId        String?
  mpStatus              String?
  trackingNumber        String?
  shippingMethod        String?
  estimatedDelivery     DateTime?
  shippingCost          Decimal?             @db.Decimal(10, 2)
  caTrackingNumber      String?              @unique
  caShipmentId          String?
  caExtOrderId          String?              @unique
  shippingAgency        String?
  shippingStreet        String?
  shippingNumber        String?
  shippingFloor         String?              @db.VarChar(3)
  shippingApartment     String?              @db.VarChar(3)
  shippingCity          String?
  shippingProvince      String?
  shippingPostalCode    String?
  caCustomerId          String?
  caOrderNumber         String?
  caShipmentId_rel      String?
  declaredValue         Decimal?             @db.Decimal(10, 2)
  estimatedDeliveryMax  String?
  estimatedDeliveryMin  String?
  ocaOrderId            String?
  ocaTrackingNumber     String?
  packageHeight         Int?
  packageLength         Int?
  packageWeight         Int?
  packageWidth          Int?
  rateValidTo           DateTime?
  recipientCellPhone    String?
  recipientEmail        String?
  recipientName         String?
  recipientPhone        String?
  senderApartment       String?              @db.VarChar(3)
  senderCellPhone       String?
  senderCity            String?
  senderEmail           String?
  senderFloor           String?              @db.VarChar(3)
  senderLocality        String?
  senderName            String?
  senderPhone           String?
  senderPostalCode      String?
  senderProvinceCode    String?              @db.Char(1)
  senderStreetName      String?
  senderStreetNumber    String?
  shippingLocality      String?
  shippingProductType   String?              @default("CP")
  shippingProvinceCode  String?              @db.Char(1)
  caImportError         String?
  caImportStatus        String?
  order_items           order_items[]
  status_history        OrderStatusHistory[]
  ca_customers          ca_customers?        @relation(fields: [caCustomerId], references: [customerId])
  ca_shipments          ca_shipments?        @relation(fields: [caShipmentId_rel], references: [id])

  @@index([caCustomerId])
  @@index([caExtOrderId])
  @@index([caTrackingNumber])
  @@index([createdAt])
  @@index([mpPaymentId])
  @@index([mpPreferenceId])
  @@index([ocaTrackingNumber])
  @@index([shippingProvinceCode])
  @@index([status])
  @@index([trackingNumber])
  @@index([status, createdAt])
  @@index([customerEmail])
}

/// Tracks order status changes for timeline display
model OrderStatusHistory {
  id        String      @id @default(cuid())
  orderId   String
  status    OrderStatus
  notes     String?
  createdAt DateTime    @default(now())
  order     orders      @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([createdAt])
  @@index([orderId, createdAt])
}
