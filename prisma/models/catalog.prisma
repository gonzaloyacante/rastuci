// =============================================================================
// PRODUCT & CATEGORY MODELS
// =============================================================================

model categories {
  id          String     @id @default(cuid())
  name        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  imageUrl    String?
  icon        String?
  isActive    Boolean    @default(true)
  products    products[]

  @@index([name])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model products {
  id                     String                   @id @default(cuid())
  name                   String
  description            String?
  price                  Decimal                  @db.Decimal(10, 2)
  stock                  Int                      @default(0)
  images                 String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  categoryId             String
  onSale                 Boolean                  @default(false)
  colors                 String[]                 @default([])
  features               String[]                 @default([])
  rating                 Float?                   @default(0)
  reviewCount            Int                      @default(0)
  sizes                  String[]                 @default([])
  salePrice              Decimal?                 @db.Decimal(10, 2)
  weight                 Int?                     @default(1000)
  height                 Int?                     @default(10)
  width                  Int?                     @default(20)
  length                 Int?                     @default(30)
  isActive               Boolean                  @default(true)
  // Legacy JSON fields - DEPRECATED, use relations instead
  sizeGuide              Json?
  colorImages            Json?
  // Relations
  order_items            order_items[]
  product_reviews        product_reviews[]
  product_variants       product_variants[]
  categories             categories               @relation(fields: [categoryId], references: [id])
  stock_reservations     stock_reservations[]
  product_color_images   product_color_images[]
  product_size_guides    product_size_guides[]
  cart_abandonment_items cart_abandonment_items[]

  @@index([categoryId])
  @@index([categoryId, name])
  @@index([categoryId, onSale])
  @@index([categoryId, price])
  @@index([colors], type: Gin)
  @@index([createdAt])
  @@index([features], type: Gin)
  @@index([isActive])
  @@index([name])
  @@index([onSale])
  @@index([onSale, price])
  @@index([price])
  @@index([sizes], type: Gin)
  @@index([stock])
}

model product_variants {
  id        String   @id @default(cuid())
  productId String
  color     String
  size      String
  stock     Int      @default(0)
  sku       String?
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, color, size])
  @@index([productId])
  @@index([sku])
}

model product_reviews {
  id           String   @id @default(cuid())
  rating       Int      @db.SmallInt
  comment      String?
  customerName String
  createdAt    DateTime @default(now())
  productId    String
  products     products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([createdAt])
  @@index([rating])
}

model stock_reservations {
  id        String   @id @default(cuid())
  productId String
  quantity  Int
  sessionId String
  expiresAt DateTime
  createdAt DateTime @default(now())
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([productId])
  @@index([sessionId])
}

/// Product color-specific images (replaces JSON colorImages field)
model product_color_images {
  id        String   @id @default(cuid())
  productId String
  color     String
  imageUrl  String
  sortOrder Int      @default(0)
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([productId, color])
}

/// Product size guide measurements (replaces JSON sizeGuide field)
model product_size_guides {
  id           String   @id @default(cuid())
  productId    String
  size         String
  measurements String // e.g., "Pecho: 40cm, Largo: 50cm"
  ageRange     String? // e.g., "2-3 a√±os"
  products     products @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, size])
  @@index([productId])
}
